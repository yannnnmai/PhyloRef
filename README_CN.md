[![DOI](https://zenodo.org/badge/DOI/10.5281/zenodo.15489512.svg)](https://doi.org/10.5281/zenodo.15489512)  
> ğŸ“Œ **å·²å½’æ¡£ç‰ˆæœ¬å¯é€šè¿‡ Zenodo è·å–**  
> åœ¨å¼•ç”¨ PhyloRef æ—¶è¯·ä½¿ç”¨è¯¥ DOIã€‚

# PhyloRef ğŸ§¬ â€” åŸºäº Snakemake æ„å»ºå’Œè´¨æ§çº¿ç²’ä½“å‚è€ƒæ•°æ®åº“

*åŠè‡ªåŠ¨æµç¨‹ï¼šä¸‹è½½ â–¶ï¸ ç­›é€‰ â–¶ï¸ æå– â–¶ï¸ æ¯”å¯¹ â–¶ï¸ æ„æ ‘ â–¶ï¸ å¼‚å¸¸æ£€æµ‹ â–¶ï¸ æ¸…æ´—ã€‚*

> **ä¸ºä»€ä¹ˆé€‰æ‹© PhyloRefï¼Ÿ**  
> ç¯å¢ƒ DNAï¼ˆeDNAï¼‰ç ”ç©¶é«˜åº¦ä¾èµ–å¹²å‡€çš„å‚è€ƒæ•°æ®åº“ã€‚PhyloRef å¯å°†åŸå§‹ GenBank åºåˆ—è½¬åŒ–ä¸ºè´¨é‡å—æ§ã€ç³»ç»Ÿå‘è‚²éªŒè¯çš„ FASTA+åˆ†ç±»åº“ï¼Œå…·å¤‡è‰¯å¥½çš„å¯é‡å¤æ€§å’Œæ‰©å±•æ€§ã€‚

---

## ğŸŒŸ æ ¸å¿ƒåŠŸèƒ½

| æ­¥éª¤ | è§„åˆ™å                  | è„šæœ¬å                                        | åŠŸèƒ½è¯´æ˜                                                                                   |
|------|--------------------------|-----------------------------------------------|--------------------------------------------------------------------------------------------|
| 1    | `download_mtgenomes`     | `download_accession.py` / `download_name.py`  | æ‰¹é‡ä¸‹è½½ GenBank æ–‡ä»¶ï¼ˆæŒ‰ accession æˆ–ç‰©ç§åï¼‰                                             |
| 2    | `filter_sequences`       | `filter_sequences.py`                         | ä¿ç•™å®Œæ•´çº¿ç²’ä½“æˆ–ç›®æ ‡åŸºå› è®°å½•ï¼Œæ”¯æŒå»é™¤æ‚äº¤ / cf. / sp. ç­‰æ ‡ç­¾                              |
| 3    | `extract_genes`          | `extract_genes.py`                            | æå–æŒ‡å®šåŸºå› å¹¶ç”Ÿæˆ *Concat.fa*                                                              |
| 4    | `group_by_order`         | `group_by_order.py`                           | æŒ‰åˆ†ç±» Order æ‹†åˆ† Concatï¼ˆä¸º checkpoint è®¾ç½®ï¼‰                                              |
| 5    | `build_tree_single`      | ï¼ˆå†…ç½® shell å‘½ä»¤ï¼‰                           | æ¯ä¸ªåˆ†ç»„è¿›è¡Œ MAFFT æ¯”å¯¹ â†’ FastTree æ„æ ‘                                                    |
| 6    | `detect_anomaly_single`  | `detect_anomaly.py`                           | åŸºäºç³»ç»Ÿå‘è‚²æ ‘çš„å¼‚å¸¸æ£€æµ‹ï¼Œè¾“å‡º PDF ä¾›äººå·¥å®¡æŸ¥                                              |
| 7    | `clean_database`         | `clean_by_anomaly.py`                         | ç§»é™¤å¼‚å¸¸åºåˆ—ï¼Œè¾“å‡ºæœ€ç»ˆ **æ¸…æ´—åçš„æ•°æ®åº“**                                                   |

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

```bash
# å…‹éš†å¹¶è¿›å…¥é¡¹ç›®ç›®å½•
git clone https://github.com/yannnnmai/PhyloRef.git
cd PhyloRef

# --- Micromamba å®‰è£…ï¼ˆæ— éœ€ root æƒé™ï¼‰ -------------------------------
mkdir -p ~/micromamba_bin
curl -Ls https://micro.mamba.pm/api/micromamba/linux-64/latest | tar -xvj -C ~/micromamba_bin
export PATH=~/micromamba_bin/bin:$PATH          # å¯æ·»åŠ è‡³ ~/.bashrc ä»¥æ°¸ä¹…ç”Ÿæ•ˆ
micromamba --version                            # æ£€æŸ¥æ˜¯å¦å®‰è£…æˆåŠŸ
# ------------------------------------------------------------------------

# åˆ›å»ºå¹¶æ¿€æ´»ç¯å¢ƒ
micromamba create -n phyloref_env -f environment.yaml
eval "$(micromamba shell hook --shell bash)"
micromamba activate phyloref_env

# è¿è¡Œç¤ºä¾‹æ•°æ®è‡³å¼‚å¸¸æ£€æµ‹ï¼ˆæ­¥éª¤ 1â€“6Â½ï¼‰
snakemake -j 8 --until anomaly_done
# â””â”€ ä½¿ç”¨ resources/ ç›®å½•ä¸‹æä¾›çš„ç¤ºä¾‹è¾“å…¥ï¼ˆçº¦ 100 æ¡åºåˆ—ï¼‰
# â””â”€ PDF å’Œ TXT æŠ¥å‘Šä¿å­˜åœ¨ results/6_anomaly/ ä¸­

# äººå·¥å®¡æŸ¥å¼‚å¸¸æ£€æµ‹æŠ¥å‘Šåï¼Œè¿è¡Œæ¸…æ´—æµç¨‹
snakemake clean_database -j 8
# æœ€ç»ˆæ¸…æ´—åçš„æ•°æ®åº“ä¿å­˜åœ¨ï¼šresults/7_final_database/outputs/cleaned/

æ‰€æœ‰è¾“å‡ºç»“æœä¿å­˜åœ¨ results/ï¼Œæ—¥å¿—ä¿¡æ¯ä½äº logs/ã€‚

â¸»

---

ğŸ“¥ æ”¯æŒçš„è¾“å…¥æ ¼å¼

| æ–‡ä»¶è·¯å¾„                   | æè¿°                                                 |
|----------------------------|------------------------------------------------------|
| resources/accessions.txt   | GenBank åºåˆ—å·åˆ—è¡¨ï¼Œæ¯è¡Œä¸€ä¸ª                         |
| resources/species.txt      | æ‹‰ä¸å­¦åçš„ç‰©ç§åˆ—è¡¨ï¼ˆä¾‹å¦‚ Cyprinus carpioï¼‰           |

â¸»

ğŸ›  å®Œæ•´å·¥ä½œæµç¨‹

1. ç¼–è¾‘ `config/config.yaml` â€”â€” è®¾ç½®ä¸‹è½½æ–¹å¼ã€ç­›é€‰æ¨¡å¼ã€ç›®æ ‡åŸºå› ã€ç³»ç»Ÿå‘è‚²æ ‘å‚æ•°ç­‰ï¼›
2. å°† accession åˆ—è¡¨æˆ–ç‰©ç§åˆ—è¡¨æ”¾å…¥ `resources/` æ–‡ä»¶å¤¹ï¼›
3. è¿è¡Œå‰å…­æ­¥æµç¨‹ï¼ˆè‡³å¼‚å¸¸æ£€æµ‹é˜¶æ®µï¼‰ï¼šsnakemake -j <NCPU> --until anomaly_done
4. å®¡æŸ¥ç³»ç»Ÿå‘è‚²æ ‘ï¼ˆPDFï¼‰å’Œå¼‚å¸¸æŠ¥å‘Šï¼ˆTXTï¼‰ï¼Œå®Œæˆäººå·¥æ ‡æ³¨åï¼Œè¿è¡Œæœ€ç»ˆæ¸…æ´—ï¼šsnakemake clean_database -j <NCPU>

ğŸ” äººå·¥å®¡æŸ¥ï¼ˆç¬¬ 6Â½ æ­¥ï¼‰

PhyloRef å°†â€œå¼‚å¸¸æ£€æµ‹â€ä¸â€œæ•°æ®åº“æ¸…æ´—â€åˆ†ç¦»ï¼Œä»¥æ”¯æŒæ‰‹åŠ¨ä¸“å®¶å®¡æŸ¥ã€‚

ğŸ’¡ å®¡æŸ¥å·¥ä½œæµç¨‹

[æ‰§è¡Œ anomaly_done æ­¥éª¤]
        â†“
[æŸ¥çœ‹ groups_*.pdf]
        â†“
[ç¼–è¾‘ *_anomaly.txt ä¸ similar.txt]
        â†“
[æ‰§è¡Œ clean_database]
        â†“
[è·å¾—æœ€ç»ˆæ¸…æ´—åçš„æ•°æ®åº“]

ğŸ“Š å¼‚å¸¸ç±»å‹

PhyloRef è‡ªåŠ¨æ£€æµ‹å¹¶åœ¨ç³»ç»Ÿå‘è‚²æ ‘ä¸­ä»¥é¢œè‰²æ ‡è®°ä¸‰ç±»å¸¸è§å¼‚å¸¸ï¼š

- ğŸŸ¢ ç±»å‹ Iï¼ˆç»¿è‰²ï¼‰ï¼šå•ä¸ªåºåˆ—è¿œç¦»å…¶æ‰€å±çš„çº²ã€ç§‘ã€å±çš„å…¶ä»–åºåˆ— â†’ å­¤ç«‹å¼‚å¸¸ï¼›
- ğŸ”µ ç±»å‹ IIï¼ˆè“è‰²ï¼‰ï¼šåŒä¸€ç‰©ç§çš„ä¸¤ä¸ªåºåˆ—åˆ†å¸ƒåœ¨æ ‘çš„ä¸åŒä½ç½® â†’ åˆ†è£‚å¯¹ï¼›
- ğŸ”´ ç±»å‹ IIIï¼ˆçº¢è‰²ï¼‰ï¼šæŸç‰©ç§ä¸­ â‰¥3 æ¡åºåˆ—æœ‰ä¸€éƒ¨åˆ†åç¦»ä¸»ç°‡ â†’ å°‘æ•°åç¦»ç¾¤ä½“ã€‚

ğŸ“ å®¡æŸ¥çš„æ–‡ä»¶

| æ–‡ä»¶è·¯å¾„                     | æè¿°                                               |
|------------------------------|----------------------------------------------------|
| results/6_anomaly/*.pdf      | å½©è‰²ç³»ç»Ÿå‘è‚²æ ‘ï¼Œæ ‡è®°æ½œåœ¨å¼‚å¸¸                      |
| results/6_anomaly/*.txt      | ä¸ PDF åŒ¹é…çš„å¼‚å¸¸åºåˆ—æŠ¥å‘Šï¼Œå«å¾…æ¸…æ´—çš„åºåˆ— ID      |
| resources/similar.txt        | å¯ä¿ç•™çš„ç›¸ä¼¼åºåˆ—ï¼ˆä¸å…¶ä»–åºåˆ—å‡ ä¹ä¸€è‡´ï¼Œä½†å¹¶éé”™è¯¯ï¼‰|

âœ… å®¡æŸ¥åæ“ä½œ

- è‹¥åˆ¤æ–­æŸäº›å¼‚å¸¸æ˜¯è¯¯æŠ¥ï¼ˆå¦‚ç³»ç»Ÿå‘è‚²æ ‘æ„å»ºè¯¯å·®ï¼‰ï¼Œè¯·å°†å¯¹åº”åºåˆ— ID ä» `*_anomaly.txt` ä¸­åˆ é™¤ï¼›
- è‹¥å‘ç°ä¸€äº›ä¸å…¶ä»–åºåˆ—éå¸¸ç›¸ä¼¼ä½†æ— ç³»ç»Ÿå‘è‚²åç¦»ï¼Œè¯·å°†å…¶æ·»åŠ è‡³ `resources/similar.txt`ï¼›
- ç„¶åè¿è¡Œï¼š

```bash
snakemake clean_database -j 8


ğŸ“‚ è¾“å‡ºæ–‡ä»¶ç»“æ„

results/
â”œâ”€â”€ 1_download/outputs/...         # ä¸‹è½½çš„ GenBank æ–‡ä»¶
â”œâ”€â”€ 2_filter/outputs/...           # ç­›é€‰åçš„åºåˆ—æ–‡ä»¶
â”œâ”€â”€ 3_extracted/outputs/...        # æå–çš„åŸºå› åºåˆ—ï¼ˆConcat.faï¼‰
â”œâ”€â”€ 4_groups/...                   # æŒ‰çº²ï¼ˆOrderï¼‰åˆ†ç»„çš„åºåˆ—
â”œâ”€â”€ 5_tree/...                     # ç³»ç»Ÿå‘è‚²æ ‘æ„å»ºç»“æœ
â”œâ”€â”€ 6_anomaly/                     # å¼‚å¸¸æ£€æµ‹è¾“å‡º
â”‚   â”œâ”€â”€ groups_*.pdf               # å¼‚å¸¸æ ‡è®°çš„ç³»ç»Ÿå‘è‚²æ ‘
â”‚   â””â”€â”€ groups_*_anomaly.txt       # å¯¹åº”çš„å¼‚å¸¸åºåˆ—æŠ¥å‘Š
â””â”€â”€ 7_final_database/outputs/      # æœ€ç»ˆæ•°æ®åº“è¾“å‡º
    â”œâ”€â”€ cleaned/                   # æ¸…æ´—åä¿ç•™çš„é«˜è´¨é‡åºåˆ—
    â”œâ”€â”€ blacklisted/               # è¢«åˆ é™¤çš„å¼‚å¸¸åºåˆ—
    â””â”€â”€ remove_similar.log         # æ ‡è®°ç›¸ä¼¼åºåˆ—çš„æ—¥å¿—è®°å½•

â¸»

### ğŸ”§ ä¸»é…ç½®å‚æ•°è¯´æ˜ï¼ˆ`config/config.yaml`ï¼‰

| å‚æ•°é”®å               | ç¤ºä¾‹å€¼                        | æè¿°                                                  |
|------------------------|-------------------------------|-------------------------------------------------------|
| `download.mode`        | `accession` / `species_name`  | é€‰æ‹©ä½¿ç”¨ Accession ç¼–å·æˆ–ç‰©ç§å­¦åè¿›è¡Œä¸‹è½½            |
| `filter.mode`          | `gene` / `complete`           | é€‰æ‹©æŒ‰åŸºå›  + åºåˆ—é•¿åº¦ç­›é€‰ï¼Œæˆ–ä»…ä¿ç•™å®Œæ•´åŸºå› ç»„        |
| `filter.gene`          | `12S`                         | ç­›é€‰æ—¶ä½¿ç”¨çš„ç›®æ ‡åŸºå› åç§°ï¼ˆå¦‚ 12Sã€COIï¼‰              |
| `extract.genes`        | `["12S", "16S"]`              | ä»åºåˆ—ä¸­æå–çš„åŸºå› åˆ—è¡¨ï¼Œå¹¶ç”¨äºæ‹¼æ¥æˆ Concat.fa       |
| `grouping.max_per_file`| `2000`                        | æ¯ä¸ªåˆ†ç»„æœ€å¤§åºåˆ—æ•°ï¼Œè¶…å‡ºå°†æ‹†åˆ†ä¸ºå¤šä¸ªå­ç»„             |
| `tree.threads`         | `30`                          | ç³»ç»Ÿå‘è‚²æ ‘æ„å»ºä¸­ MAFFT çš„çº¿ç¨‹æ•°                      |
| `outgroups`            | `NC_023455, NC_035057`        | ç³»ç»Ÿå‘è‚²æ ‘æ„å»ºæ—¶ç”¨äºå®šæ ¹çš„å¤–ç±»ç¾¤åºåˆ— IDï¼ˆå¯é€‰ï¼‰      |

â¸»

âš™ï¸ å¯é‡å¤æ€§ä¿éšœ

- å®Œæ•´ç¯å¢ƒé…ç½®è®°å½•äº `environment.yaml`ï¼Œå¯é€šè¿‡ micromamba åˆ›å»ºç¯å¢ƒ
- æŒç»­é›†æˆï¼šæ¯æ¬¡æäº¤è‡ªåŠ¨ä½¿ç”¨ GitHub Actions è¿è¡Œæµ‹è¯•ï¼ˆåŸºäº demo é…ç½®ï¼‰
- æ•°æ®åº“ç‰ˆæœ¬æ§åˆ¶ï¼šå®šæœŸå½’æ¡£è‡³ Zenodoï¼Œç¡®ä¿å¯å¼•ç”¨æ€§ä¸é•¿æœŸå¯ç”¨æ€§

â¸»

ğŸ“– å¼•ç”¨æ–¹å¼

Mai Y. ç­‰äººï¼ŒPhyloRef: åŸºäº Snakemake çš„åŠè‡ªåŠ¨å‚è€ƒæ•°æ®åº“ç³»ç»Ÿå‘è‚²å¼‚å¸¸æ£€æµ‹ä¸æ¸…æ´—æµç¨‹ï¼ˆè®ºæ–‡å‡†å¤‡ä¸­ï¼‰

Zenodo DOI: 10.5281/zenodo.15489512

> è¯·åœ¨å­¦æœ¯å¼•ç”¨ä¸­ä½¿ç”¨ä¸Šè¿° DOIã€‚

â¸»

ğŸ¤ è´¡çŒ®æŒ‡å—

1. Fork æœ¬é¡¹ç›®ï¼Œå¹¶åˆ›å»ºæ–°çš„åŠŸèƒ½åˆ†æ”¯ï¼ˆä¾‹å¦‚ï¼š`feat/<åŠŸèƒ½å>`ï¼‰
2. éµå¾ª Conventional Commits é£æ ¼æäº¤ä»£ç ï¼ˆä¾‹å¦‚ï¼š`feat:`ã€`fix:`ã€`docs:` ç­‰ï¼‰
3. æäº¤ Pull Requestï¼Œå¿…é¡»é€šè¿‡ CI æµ‹è¯•
4. æ¬¢è¿ä»»ä½•é—®é¢˜åé¦ˆã€å»ºè®®å’ŒåŠŸèƒ½è¯·æ±‚ï¼

ğŸš§ è§„åˆ’ä¸­ï¼šå°†é›†æˆ pre-commitã€blackã€ruff ä»¥å®ç°ç»Ÿä¸€çš„ä»£ç é£æ ¼æ£€æŸ¥å’Œæ ¼å¼åŒ–

â¸»

ğŸ›¡ æˆæƒè®¸å¯

MIT License â€” è¯¦è§ LICENSE æ–‡ä»¶

â¸»

ğŸ‘¤ è”ç³»æ–¹å¼

ç»´æŠ¤è€…ï¼šYan Mai  
å•ä½ï¼šä¸Šæµ·æµ·æ´‹å¤§å­¦ æ°´äº§ä¸ç”Ÿå‘½å­¦é™¢  
ğŸ“§ é‚®ç®±ï¼šyann_maii@foxmail.com

â¸»

ğŸŒ¿ ç¥ä½ æ„å»ºçš„å‚è€ƒæ•°æ®åº“ç³»ç»Ÿå‘è‚²å…³ç³»æ¸…æ™°ã€å•ç³»æ¼”åŒ–ï¼
